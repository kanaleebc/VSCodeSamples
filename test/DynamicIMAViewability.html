<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>AdPlayer Test</title>

    <link
      href="//players.brightcove.net/videojs-ima3/4/videojs-ima3.css"
      rel="stylesheet"
    />

    <style>
      .video-js {
        width: 640px;
        height: 360px;
      }
      .vjs-ad-playing.vjs-ad-playing
        .vjs-progress-control
        .vjs-progress-control {
        height: 0.1em;
        top: 0.1em;
      }
    </style>
  </head>

  <body>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>

    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Duis ullamcorper varius vulputate. Mauris et purus neque. Duis at erat
      vulputate purus mattis blandit ac id erat. Nullam tempor metus in lorem
      aliquam gravida. Nullam id eros condimentum dui maximus posuere non et
      neque. Fusce dapibus neque finibus nunc accumsan lobortis.
    </p>
    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Duis ullamcorper varius vulputate. Mauris et purus neque. Duis at erat
      vulputate purus mattis blandit ac id erat. Nullam tempor metus in lorem
      aliquam gravida. Nullam id eros condimentum dui maximus posuere non et
      neque. Fusce dapibus neque finibus nunc accumsan lobortis.
    </p>
    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>

    <video-js
      id="adsPlayer"
      data-video-id="6334119588112"
      data-account="6415663006001"
      data-player="default"
      data-embed="default"
      class="video-js"
      playsinline
      controls
    ></video-js>
    <div></div>
    <button id="ondemand" onclick="myPlayer.ima3.adrequest();">
      Ad Request
    </button>
    <br />
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>

    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Duis ullamcorper varius vulputate. Mauris et purus neque. Duis at erat
      vulputate purus mattis blandit ac id erat. Nullam tempor metus in lorem
      aliquam gravida. Nullam id eros condimentum dui maximus posuere non et
      neque. Fusce dapibus neque finibus nunc accumsan lobortis.
    </p>
    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>

    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p>
      Duis ullamcorper varius vulputate. Mauris et purus neque. Duis at erat
      vulputate purus mattis blandit ac id erat. Nullam tempor metus in lorem
      aliquam gravida. Nullam id eros condimentum dui maximus posuere non et
      neque. Fusce dapibus neque finibus nunc accumsan lobortis.
    </p>
    <p>
      Curabitur scelerisque mi a ante euismod congue. Suspendisse rhoncus, odio
      non faucibus cursus, metus diam vestibulum velit, eu commodo nunc orci et
      purus. Sed eget ultrices sem. Nullam egestas ipsum augue, eu condimentum
      ipsum bibendum ac. Phasellus varius orci eget est aliquam posuere. Nam
      ornare at felis ut fermentum. Suspendisse auctor ultricies augue vitae
      dapibus. Nam efficitur urna velit, quis interdum augue vestibulum et.
      Pellentesque aliquam, massa et condimentum viverra, lacus est mattis
      ipsum, nec facilisis eros tortor quis justo.
    </p>
    <p>
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent iaculis
      est et libero ultricies condimentum. Suspendisse ut ante sed leo consequat
      cursus eget a ex. Etiam aliquet augue sed elit aliquet iaculis. Nunc
      iaculis ultrices congue. Pellentesque at enim sapien. Donec nec semper
      sem. Aenean dui quam, euismod vel commodo nec, cursus tempor risus. Donec
      ligula mi, imperdiet quis lorem id, blandit semper dolor. Duis accumsan
      tempor malesuada.
    </p>
    <p style="text-align: left; font-family: monospace">
      <b><u>MESSAGE LOG:</u></b>
    </p>
    <p id="message"></p>

    <script src="//players.brightcove.net/6415663006001/default_default/index.js"></script>
    <script src="//players.brightcove.net/videojs-ima3/4/videojs-ima3.min.js"></script>

    <script type="text/javascript">
      // https://player.support.brightcove.com/plugins/advertising-ima3-plugin.html

      var myPlayer;
      const EVENTS = [
        "loadstart",
        /*          'progress', */
        "suspend",
        "abort",
        "error",
        "emptied",
        "stalled",
        "loadedmetadata",
        "loadeddata",
        "canplay",
        "canplaythrough",
        "playing",
        "waiting",
        "seeking",
        "seeked",
        "ended",
        "durationchange",
        /*          'timeupdate', */
        "play",
        "pause",
        "ratechange",
        "resize",
        "volumechange",
      ];
      //////////////////////////////////////////////////////
      // IMA Playground: https://codepen.io/victor-ramos/pen/BRVbeR?editors=1010
      // IMA SDK Document: https://developers.google.com/interactive-media-ads/docs/sdks/html5
      //////////////////////////////////////////////////////

      // https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.AdsRenderingSettings#uiElements

      bc("adsPlayer").ima3({
        adTechOrder: ["html5", "flash"],

        // VAST3 (Google standard one)
        //serverUrl: 'https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dskippablelinear&correlator=',
        serverUrl:
          "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/single_ad_samples&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ct%3Dlinear&correlator=",
        // <Playlist>
        /*
        serverUrl: 'http://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F15018773%2Feverything2&ciu_szs=300x250%2C468x60%2C728x90&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=dummy&correlator=[timestamp]&cmsid=133&vid=10XWSh7W4so&ad_rule=1',
        */

        // requestMode: 'oncue',
        // useMediaCuePoints: true,
        /*
            useMediaCuePoints must be set to true
            requestMode must be set to the string oncue
            serverUrl must be set to a valid VAST tag        
        */
        //requestMode: 'onload',
        //requestMode: 'onplay',
        requestMode: "ondemand",
        timeout: 6000,
        debug: true,
        hardTimeouts: false,
        loadingSpinner: false,
        vpaidMode: "ENABLED",
        ima3SdkSettings: {
          disableCustomPlaybackForIOS10Plus: true, // enables skippable ads on iOS
          autoPlayAdBreaks: false,
          numRedirects: 10,
        },
      });

      videojs("adsPlayer").on("ima3-ready", function () {
        message.innerHTML += "*** ima3-ready triggered<br>";
        message.innerHTML +=
          "*** Google IMA3 SDK version: " + google.ima.VERSION + "<br>";
        message.innerHTML +=
          "*** Brightcove IMA3 version: " + this.ima3.VERSION + "<br>";

        if (videojs("adsPlayer").ima3) {
          message.innerHTML += "*** player.ima exists. " + "<br>";
        } else {
          message.innerHTML += "*** player.ima doesn't exists. " + "<br>";
        }

        /*
        Description: https://support.brightcove.com/advertising-ima3-plugin#Methods
        
        If there is no Ads Manager yet, this method saves your settings and when an Ads Manager is created it uses the settings you provided. If an Ads Manager already exists, it is updated to use your settings. In either case, any new Ads Managers created in the future will also use the most recent settings you provided. You can create an AdsRenderingSettings object by accessing the IMA SDK directly. 

        https://developers.google.com/interactive-media-ads/docs/sdks/html5/v3/reference/js/ima.AdsRenderingSettings

        * JavaScript: videojs("adsPlayer").ima3.adsRenderingSettings_
        */
        var adsRenderingSettings = new google.ima.AdsRenderingSettings();
        if (videojs("adsPlayer").ima3) {
          message.innerHTML += "*** adsRenderingSettings exists. " + "<br>";
        } else {
          message.innerHTML +=
            "*** adsRenderingSettings doesn't exists. " + "<br>";
        }

        // This line (need both elements) shows the ad countdown.
        adsRenderingSettings.uiElements = [
          google.ima.UiElements.COUNTDOWN,
          google.ima.UiElements.AD_ATTRIBUTION,
        ];

        // adsRenderingSettings.bitrate = 2500;
        // adsRenderingSettings.enablePreloading = true;
        // adsRenderingSettings.useVideoAdUi = true;
        // adsRenderingSettings.disableUi = true;
        // adsRenderingSettings.playAdsAfterTime = 5;
        videojs("adsPlayer").ima3.setAdsRenderingSettings(adsRenderingSettings);
      });

      videojs("adsPlayer").on("loadedmetadata", function () {
        message.innerHTML += "### loadedmetadata triggered<br>";
      });

      videojs("adsPlayer").on("ads-request", function () {
        message.innerHTML += "*** ads-request done<br>";
      });

      videojs("adsPlayer").on("loadstart", function () {
        myPlayer = this;
        message.innerHTML += "### loadstart triggered<br>";

        //myPlayer.ima3.adMacroReplacement = function(url){
        //  message.innerHTML += "*** adMacroReplacement() called<br>";
        //    return "https://" + myPlayer.mediainfo.name;
        //};
        myPlayer.on(EVENTS, function (event) {
          videojs.log(event);
        });

        myPlayer.on("ads-ad-started", function () {
          message.innerHTML += "*** ads-ad-started triggered<br>";
        });

        myPlayer.on("ima3-ad-error", function () {
          message.innerHTML += "*** ima3-ad-error triggered<br>";
        });

        myPlayer.on("ads-ad-ended", function () {
          message.innerHTML += "*** ads-ad-ended triggered<br>";
        });

        myPlayer.on("adstart", function () {
          message.innerHTML += "*** adstart triggered<br>";
        });

        myPlayer.on("adend", function () {
          message.innerHTML += "*** adend triggered<br>";
        });

        myPlayer.on("ads-load", function () {
          message.innerHTML += "*** ad loaded<br>";
        });
      });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://players.brightcove.net/6415663006001/YjmOHG9yV_default/index.min.js"></script>
    <script src="scroll-into-view.js"></script>

    <script type="text/javascript">
      videojs.getPlayer("adsPlayer").ready(function () {
        var myPlayer = this;
        myPlayer.scrollIntoView();
      });
    </script>
    <script>
      videojs.registerPlugin("scrollIntoView", function () {
        var myPlayer = this;

        // +++ Execute every time page is scrolled +++
        window.onscroll = checkIfVideoInView;

        // +++ Called on scroll, check if in view and the play/pause +++
        function checkIfVideoInView() {
          if (isScrolledIntoView(adsPlayer)) {
            // the player is fully in the viewport
            myPlayer.play();
          } else {
            // the player is not in the viewport
            myPlayer.pause();
          }
        }

        // +++ Checks if player is in view +++
        function isScrolledIntoView(elem) {
          // Get the position of the viewport
          var docViewTop = $(window).scrollTop();
          var docViewBottom = docViewTop + $(window).height();

          // get the position of the player element
          var elemTop = $(elem).offset().top;
          var elemBottom = elemTop + $(elem).height();

          // Determine if the player element is in fully in the viewport
          return (
            elemBottom >= docViewTop &&
            elemTop <= docViewBottom &&
            elemBottom <= docViewBottom &&
            elemTop >= docViewTop
          );
        }
      });
    </script>
  </body>
</html>
